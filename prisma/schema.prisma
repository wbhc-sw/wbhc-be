generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User model for authentication and role-based access
model User {
  id          String   @id @default(uuid())
  username    String   @unique
  email       String   @unique
  passwordHash String
  role        String   @default("company_viewer")
  companyId   Int?     // For company-specific roles
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relationships
  company     Company? @relation(fields: [companyId], references: [companyID])
  
  @@index([role])
  @@index([companyId])
  @@index([username])
  @@index([email])
}

model Company {
  name           String
  description    String?
  phoneNumber    String?
  url            String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  companyID      Int             @id @default(autoincrement())
  
  // Relationships
  investors      Investor[]
  investorAdmins InvestorAdmin[]
  users          User[]          // Users associated with this company

  @@index([name])
  @@index([createdAt])
}

model Investor {
  id                  String   @id @default(uuid())
  fullName            String
  phoneNumber         String?
  city                String
  source              String   @default("received")
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  emailSentToAdmin    Boolean  @default(false)
  emailSentToInvestor Boolean  @default(false)
  calculatedTotal     Float?
  sharesQuantity      Int?
  companyID           Int?
  transferred         Boolean  @default(false)
  company             Company? @relation(fields: [companyID], references: [companyID])

  @@index([sharesQuantity])
  @@index([createdAt])
  @@index([companyID])
}

model InvestorAdmin {
  id                  Int      @id @unique @default(autoincrement())
  fullName            String
  phoneNumber         String?
  city                String
  source              String   @default("received")
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  emailSentToAdmin    Boolean  @default(false)
  emailSentToInvestor Boolean  @default(false)
  notes               String?
  callingTimes        Int?     @default(0)
  leadStatus          String   @default("new")
  originalInvestorId  String?
  investmentAmount    Float?
  calculatedTotal     Float?
  sharesQuantity      Int?
  companyID           Int?
  msgDate             DateTime?
  company             Company? @relation(fields: [companyID], references: [companyID])

  @@index([sharesQuantity])
  @@index([createdAt])
  @@index([leadStatus])
  @@index([companyID])
}

model InvestorAdmin_Temp {
  id                  BigInt    @id @unique @default(autoincrement())
  fullName            String?
  phoneNumber         String?
  city                String?
  source              String?
  createdAt           DateTime? @db.Timestamp(6)
  updatedAt           DateTime? @db.Timestamp(6)
  emailSentToAdmin    Boolean?  @default(false)
  emailSentToInvestor Boolean?  @default(false)
  notes               String?
  callingTimes        Int?      @default(0)
  leadStatus          String?
  originalInvestorId  String?
  investmentAmount    Float?
  calculatedTotal     Float?
  sharesQuantity      Int?
  companyID           Int?
}
